generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

<<<<<<< HEAD
=======
model User {
  id             Int            @id @default(autoincrement())
  username       String?        @unique
  businessName   String?        @unique
  email          String         @unique
  phone          String         @unique
  password       String
  profileImage   String?
  approved       Boolean        @default(false)
  role           String         @default("user")
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  services       Service[]
  payments       Payment[]
  availabilities Availability[]
  foodDeliveries FoodDelivery[] // <--- Add this line
  serviceCategory ServiceCategory?
}

enum LocationType {
  CUSTOM
  PROVIDER
  HYBRID
}

model Service {
  id              Int              @id @default(autoincrement())
  category        String
  name            String
  images          String
  price           Float
  location        String
  locationType    LocationType     @default(PROVIDER)
  description     String
  duration        Int
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  userId          Int
  user            User             @relation(fields: [userId], references: [id])
  payments        Payment[]        @relation("ServicePayments")
  paymentServices PaymentService[] // <-- Add this line
}

model FoodDelivery {
  id                    Int                   @id @default(autoincrement())
  category              String
  name                  String
  price                 Float
  ingredients           String?
  foodDescription       String?
  foodImage             String?
  userId                Int
  user                  User                  @relation(fields: [userId], references: [id])
  createdAt             DateTime              @default(now())
  payments              Payment[]             @relation("FoodDeliveryPayments")
  paymentFoodDeliveries PaymentFoodDelivery[] // <-- Add this line
}

model PaymentService {
  id           Int     @id @default(autoincrement())
  paymentId    Int
  serviceId    Int
  quantity     Int     @default(1)
  initialPrice Int? // <--- Add this line
  payment      Payment @relation(fields: [paymentId], references: [id])
  service      Service @relation(fields: [serviceId], references: [id])

  @@unique([paymentId, serviceId])
}

model PaymentFoodDelivery {
  id             Int          @id @default(autoincrement())
  paymentId      Int
  foodDeliveryId Int
  quantity       Int          @default(1)
  initialPrice   Int? // <--- Add this line
  payment        Payment      @relation(fields: [paymentId], references: [id])
  foodDelivery   FoodDelivery @relation(fields: [foodDeliveryId], references: [id])

  @@unique([paymentId, foodDeliveryId])
}

model Payment {
  id                    Int                   @id @default(autoincrement())
  bookingLocation       String?
  firstName             String
  lastName              String
  email                 String
  phoneNumber           String
  datetime              DateTime
  createdAt             DateTime              @default(now())
  status                String                @default("pending")
  transactionRef        String? // For AFRIPAY transaction_ref
  paymentMethod         String? // For AFRIPAY payment_method
  amount                Float? // Payment amount from AfriPay
  currency              String? // Payment currency from AfriPay
  message               String? // Payment message from AfriPay
  gatewayResponse       String? // Full gateway response as JSON
  userId                Int
  user                  User                  @relation(fields: [userId], references: [id])
  services              Service[]             @relation("ServicePayments")
  foodDeliveries        FoodDelivery[]        @relation("FoodDeliveryPayments")
  paymentServices       PaymentService[]
  paymentFoodDeliveries PaymentFoodDelivery[]

  // Booking validation fields
  isAvailable       Boolean @default(true) // Was the provider available at booking time?
  unavailableReason String? // Reason if not available (from provider's unavailability/emergency)
  isTimeBooked      Boolean @default(false) // True if another customer already booked this time
  conflictWithId    Int? // Reference to conflicting Payment (if any)
}

>>>>>>> 444a66b90015be97610b735635a3c4798608a0a6
model Availability {
  id          Int      @id @default(autoincrement())
  userId      Int
  dayFrom     String
  dayTo       String
  hourFrom    String
  hourTo      String
  unavailable Boolean  @default(false)
  reason      String?
  emergency   Boolean  @default(false)
  duration    Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  User        User     @relation(fields: [userId], references: [id])

  @@index([userId], map: "Availability_userId_fkey")
}

model Feedback {
  id        Int      @id @default(autoincrement())
  name      String
  email     String
  phone     String?
  message   String
  createdAt DateTime @default(now())
}

<<<<<<< HEAD
model FoodDelivery {
  id                  Int                   @id @default(autoincrement())
  category            String
  name                String
  price               Float
  ingredients         String?
  foodDescription     String?
  foodImage           String?
  userId              Int
  createdAt           DateTime              @default(now())
  User                User                  @relation(fields: [userId], references: [id])
  PaymentFoodDelivery PaymentFoodDelivery[]
  Payment             Payment[]             @relation("FoodDeliveryPayments")

  @@index([userId], map: "FoodDelivery_userId_fkey")
}

model PasswordReset {
  id        Int      @id @default(autoincrement())
  email     String
  otp       String
  expiresAt DateTime
}

model Payment {
  id                  Int                   @id @default(autoincrement())
  bookingLocation     String?
  firstName           String
  lastName            String
  email               String
  phoneNumber         String
  datetime            DateTime
  createdAt           DateTime              @default(now())
  status              String                @default("pending")
  transactionRef      String?
  paymentMethod       String?
  amount              Float?
  currency            String?
  message             String?
  gatewayResponse     String?
  userId              Int
  isAvailable         Boolean               @default(true)
  unavailableReason   String?
  isTimeBooked        Boolean               @default(false)
  conflictWithId      Int?
  User                User                  @relation(fields: [userId], references: [id])
  PaymentFoodDelivery PaymentFoodDelivery[]
  PaymentService      PaymentService[]
  FoodDelivery        FoodDelivery[]        @relation("FoodDeliveryPayments")
  Service             Service[]             @relation("ServicePayments")

  @@index([userId], map: "Payment_userId_fkey")
}

model PaymentFoodDelivery {
  id             Int          @id @default(autoincrement())
  paymentId      Int
  foodDeliveryId Int
  quantity       Int          @default(1)
  initialPrice   Int?
  FoodDelivery   FoodDelivery @relation(fields: [foodDeliveryId], references: [id])
  Payment        Payment      @relation(fields: [paymentId], references: [id])

  @@unique([paymentId, foodDeliveryId])
  @@index([foodDeliveryId], map: "PaymentFoodDelivery_foodDeliveryId_fkey")
}

model PaymentService {
  id           Int     @id @default(autoincrement())
  paymentId    Int
  serviceId    Int
  quantity     Int     @default(1)
  initialPrice Int?
  Payment      Payment @relation(fields: [paymentId], references: [id])
  Service      Service @relation(fields: [serviceId], references: [id])

  @@unique([paymentId, serviceId])
  @@index([serviceId], map: "PaymentService_serviceId_fkey")
}

model Service {
  id             Int                  @id @default(autoincrement())
  category       String
  name           String
  images         String
  price          Float
  location       String
  locationType   Service_locationType @default(PROVIDER)
  description    String
  duration       Int
  createdAt      DateTime             @default(now())
  updatedAt      DateTime
  userId         Int
  PaymentService PaymentService[]
  User           User                 @relation(fields: [userId], references: [id])
  Payment        Payment[]            @relation("ServicePayments")

  @@index([userId], map: "Service_userId_fkey")
}

model User {
  id           Int            @id @default(autoincrement())
  username     String?        @unique
  businessName String?        @unique
  email        String         @unique
  phone        String         @unique
  password     String
  profileImage String?
  approved     Boolean        @default(false)
  role         String         @default("user")
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  Availability Availability[]
  FoodDelivery FoodDelivery[]
  Payment      Payment[]
  Service      Service[]
}

enum Service_locationType {
  CUSTOM
  PROVIDER
  HYBRID
=======
enum ServiceCategory {
  MASSAGE
  FOOD_DELIVERY
>>>>>>> 444a66b90015be97610b735635a3c4798608a0a6
}
